/*! taxishareserver 2017-01-30 */
var mongoose=require("mongoose"),Schema=mongoose.Schema,userSchema=new Schema({name:{type:String},email:{type:String},password:{type:String},location:{type:Array,index:"2dsphere"},active:{type:Boolean},description:{type:String}});module.exports=mongoose.model("User",userSchema);var mongoose=require("mongoose"),User=mongoose.model("User"),passwordHash=require("password-hash");User.findAllUsers=function(a,b){User.find(function(a,c){a&&b.send(500,a.message),console.log("GET /users"),b.status(200).jsonp(c)})},User.login=function(a,b){var c=a.params.email,d=a.params.password;console.log(c),User.findOne({email:c},function(a,c){return a?b.status(500).send(a.message):c?passwordHash.verify(d,c.password)?void b.status(200).jsonp(c):b.status(500).send("Password incorrect"):b.status(500).send("User not found")})},User.findById=function(a,b){User.findOne({_id:a.params.id},function(c,d){return c?b.status(500).send(c.message):(console.log("GET /user/"+a.params.id),void b.status(200).jsonp(d))})},User.addUser=function(a,b){var c=new User({name:a.body.name,email:a.body.email,password:a.body.password,location:a.body.location,description:a.body.description});c.save(function(a,c){return a?b.status(500).send(a.message):void b.status(200).jsonp(c)})},User.updateUser=function(a,b){User.findOne({_id:a.params.id},function(c,d){d.name=a.body.name,d.email=a.body.email,d.password=a.body.password,d.location=a.body.location,d.description=a.body.description,d.save(function(c){return c?b.status(500).send(c.message):(console.log("PUT /users/"+a.params.id),void b.status(200).send("user saved"))})})},User.deleteUser=function(a,b){User.findById(a.params.id,function(a,c){c.remove(function(a){return a?b.status(500).send(a.message):void b.status(200).send()})})},User.getNear=function(a,b){var c=parseFloat(a.params.lat),d=parseFloat(a.params.lng);User.find({location:{$near:{$geometry:{type:"Point",coordinates:[d,c]},$maxDistance:1e3}}},function(a,c){a&&b.status(500).send(a.message),console.log("GET /users/near"),b.status(200).jsonp(c)})};